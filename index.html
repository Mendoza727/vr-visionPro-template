<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Hand Tracking! • A-Frame</title>
    <meta name="description" content="Hand Tracking! • A-Frame" />
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe-master.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.4/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.4.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/components/sphere-collider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/physx@v0.1.0/dist/physx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls@0.4.3/dist/aframe-blink-controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.10/build/handy-controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.10/build/magnet-helpers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-htmlmesh@2.2.0/build/aframe-html.min.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="splash" style="
            background-color: rgb(31, 32, 33);
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;"
        >
        <div style="
            width: 304px;
            max-width: 90%;
            background: rgba(31, 32, 33, 0.78);
            border-radius: 8px;
            padding: 50px 20px 50px 20px;
            box-sizing: border-box;
        ">
                <h1 style="color: white;">
                    Experiencia <span style="color: #6AE5E0;">Inmersiva</span>
                </h1>
            <button onclick="showScene()" id="startingButton">Comenzar</buttono>
        </div>
    </div>

    <a-scene environment="preset: forest" physics="gravity: -9.8" style="display: none;"> <!-- Añade el atributo physics -->

        <a-assets>
            <a-asset-item id="hospital-room" src="models/hospital-room.glb"></a-asset-item>
            <a-asset-item id="jeringa" src="models/jeringa.glb" draggable></a-asset-item>
            <a-asset-item id="saxenda" src="models/saxenda.fbx"></a-asset-item>
        </a-assets>
        
        <a-entity gltf-model="#hospital-room" position="0 0.2 -1" scale="0.5 0.5 0.5" draggable="true"></a-entity>
        <a-box position="0 1.5 -0.5" rotation="0 0 0" material="color: #fcdab7; transparent: true; opacity: 0.0;" scale="0.5 0.5 0.5" grabbable>
            <a-entity gltf-model="#jeringa" id="modeloJeringa" scale="0.5 0.5 0.5" position="0 0 -0.1" draggable></a-entity>        
        </a-box>
        

        <a-entity 
            id="saxendaModel" 
            fbx-model="#saxenda" 
            scale="0.5 0.5 0.5" 
            position="0 1.5 -0.5" 
            draggable="true">
        </a-entity>

        <!-- Agrega un cuadro que se pueda agarrar con colisiones -->

        <a-entity id="menu" menu position="0 1.5 -0.5" rotation="-45 0 0" event-manager visible="false">
            <a-entity slider position="0 0.10 0"></a-entity>
            <a-entity id="sphereButton" button="label: sphere" position="-0.15 0 0"></a-entity>
            <a-entity id="boxButton" button="label: box" position="0 0 0"></a-entity>
            <a-entity id="torusButton" button="label: torus" position="0.15 0 0"></a-entity>
            <a-entity id="darkModeButton" button="label: Dark Mode; width: 0.20; toggable: true"
                position="0 -0.10 0"></a-entity>
        </a-entity>

        <!-- Agrega el sistema de física -->
        <a-entity id="leftHand" hand-controls="hand: left;" hand-tracking-controls="hand: left;"
            hand-tracking-grab-controls="hand: left;"></a-entity>
        <a-entity id="rightHand" hand-controls="hand: right;" hand-tracking-controls="hand: right;"
            hand-tracking-grab-controls="hand: right;"></a-entity>
        <a-entity id="ground" static-body geometry="primitive: plane; width: 100; height: 100" rotation="-90 0 0"
            material="visible: false;"></a-entity>
    </a-scene>

    <script>
        function showScene() {
            // Muestra la escena
            document.querySelector('a-scene').style.display = 'block';
            document.getElementById('splash').style.display = 'none'

            if ('xr' in navigator) {
                if ('xr' in navigator) {
                    navigator.xr.requestDevice().then((device) => {
                      // Permiso concedido
                      console.log('Se concedieron permisos para XR');
                    }).catch((error) => {
                      // Permiso denegado o error
                      console.error('Error al solicitar permisos para XR:', error);
                    });
                  } else {
                    // Navegador no compatible con WebXR
                    console.error('Este navegador no es compatible con WebXR');
                  }
            }
        }
    </script>
</body>

</html>